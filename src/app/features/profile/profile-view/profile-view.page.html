<ion-content class="profile-content">
  <div class="profile-header">
    <ion-button fill="clear" class="back-btn" (click)="goBack()">
      <ion-icon name="arrow-back-outline"></ion-icon>
    </ion-button>
    <h1>Profile</h1>
    <ion-button fill="clear" class="edit-btn" (click)="toggleEditMode()">
      <ion-icon [name]="isEditMode ? 'checkmark-outline' : 'create-outline'"></ion-icon>
    </ion-button>
  </div>

  <div class="profile-layout">
    <!-- Left Side - Profile Card -->
    <div class="profile-sidebar">
      <div class="profile-card">
        <div class="avatar-container" [class.editable]="isEditMode" (click)="isEditMode && triggerImageUpload()">
          <ion-avatar class="profile-avatar">
            <img [src]="(editProfile.avatar_url ? editProfile.avatar_url: userProfile.avatar_url) || 'assets/icon/default-avatar.svg'" alt="Profile">
          </ion-avatar>
          @if (isEditMode) {
            <div class="camera-badge">
              <ion-icon name="camera-outline"></ion-icon>
            </div>
          }
        </div>
        <input type="file" #imageUpload accept="image/*" (change)="onImageSelect($event)" style="display: none;">
        
        <div class="profile-info">
          <h2 class="name">{{ userProfile.full_name || 'User Name' }}</h2>
          <p class="email">{{ userProfile.email || 'user@example.com' }}</p>
        </div>
      </div>
    </div>

    <!-- Right Side - Scrollable Content -->
    <div class="profile-main">
      <div class="scrollable-content">
        <!-- Personal Info -->
        <div class="info-card">
          <h3 class="card-title">Personal Information</h3>
          
          @if (!isEditMode) {
            <div class="info-list">
              <div class="info-row">
                <div class="info-icon">
                  <ion-icon name="person-outline"></ion-icon>
                </div>
                <div class="info-content">
                  <span class="label">Full Name</span>
                  <span class="value">{{ userProfile.full_name || 'Not provided' }}</span>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon">
                  <ion-icon name="call-outline"></ion-icon>
                </div>
                <div class="info-content">
                  <span class="label">Phone</span>
                  <span class="value">{{ userProfile.phone_number || 'Not provided' }}</span>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon">
                  <ion-icon name="transgender-outline"></ion-icon>
                </div>
                <div class="info-content">
                  <span class="label">Gender</span>
                  <span class="value">{{ userProfile.gender || 'Not specified' }}</span>
                </div>
              </div>

              <div class="info-row">
                <div class="info-icon">
                  <ion-icon name="calendar-outline"></ion-icon>
                </div>
                <div class="info-content">
                  <span class="label">Date of Birth</span>
                  <span class="value">{{ (userProfile.dob | dateFormat) || 'Not provided' }}</span>
                </div>
              </div>

              <div class="info-row bio-row">
                <div class="info-icon">
                  <ion-icon name="document-text-outline"></ion-icon>
                </div>
                <div class="info-content">
                  <span class="label">Bio</span>
                  <span class="value bio-text">{{ userProfile.bio || 'No bio added yet' }}</span>
                </div>
              </div>
            </div>
          } @else {
            <div class="edit-form">
              <ion-item class="edit-item">
                <ion-icon name="person-outline" slot="start"></ion-icon>
                <ion-input 
                  class="common-input" 
                  [(ngModel)]="editProfile.full_name" 
                  labelPlacement="floating"
                  label="Full Name"
                  fill="outline"
                  mode="md"
                  placeholder="Enter full name">
                </ion-input>
              </ion-item>

              <ion-item class="edit-item">
                <ion-icon name="call-outline" slot="start"></ion-icon>
                <ion-input 
                  class="common-input" 
                  [(ngModel)]="editProfile.phone_number" 
                  labelPlacement="floating"
                  label="Phone Number"
                  fill="outline"
                  mode="md"
                  placeholder="98765 43210">
                </ion-input>
              </ion-item>

              <ion-item class="edit-item">
                <ion-icon name="transgender-outline" slot="start"></ion-icon>
                <ion-select 
                  class="common-input"
                  [(ngModel)]="editProfile.gender" 
                  labelPlacement="floating"
                  label="Gender"
                  mode="md"
                  fill="outline"
                  placeholder="Select gender">
                  <ion-select-option value="male">Male</ion-select-option>
                  <ion-select-option value="female">Female</ion-select-option>
                  <ion-select-option value="other">Other</ion-select-option>
                  <ion-select-option value="prefer-not-to-say">Prefer not to say</ion-select-option>
                </ion-select>
              </ion-item>

              <ion-item class="edit-item">
                <ion-icon name="calendar-outline" slot="start"></ion-icon>
                <div class="date-input-wrapper" 
                     [class.has-focus]="isDateFocused" 
                     [class.has-value]="dob"
                     [class.ion-touched]="isDateTouched"
                     [class.ion-invalid]="isDateInvalid"
                     [class.ion-valid]="isDateValid">
                  <label class="floating-label">Date of Birth</label>
                  <input 
                    #dateOfBirthInput
                    type="text"
                    placeholder="Select date of birth"
                    (focus)="isDateFocused = true"
                    (blur)="onDateBlur()"
                    readonly>
                </div>
              </ion-item>

              <ion-item class="edit-item">
                <ion-icon name="document-text-outline" slot="start"></ion-icon>
                <ion-textarea 
                  class="common-input" 
                  [(ngModel)]="editProfile.bio" 
                  labelPlacement="floating"
                  label="Bio"
                  fill="outline"
                  mode="md"
                  placeholder="Tell us about yourself..." 
                  rows="5">
                </ion-textarea>
              </ion-item>
            </div>
          }
        </div>

        <!-- Settings Card -->
        <div class="settings-card">
          <h3 class="card-title">Settings</h3>
          
          <div class="settings-list">
            <div class="setting-row" (click)="changePassword()">
              <div class="setting-icon">
                <ion-icon name="lock-closed-outline"></ion-icon>
              </div>
              <div class="setting-content">
                <span class="setting-label">Change Password</span>
              </div>
              <ion-icon name="chevron-forward-outline" class="chevron"></ion-icon>
            </div>

            <div class="setting-row">
              <div class="setting-icon">
                <ion-icon name="notifications-outline"></ion-icon>
              </div>
              <div class="setting-content">
                <span class="setting-label">Notifications</span>
              </div>
              <ion-toggle [(ngModel)]="notificationsEnabled" mode="md" class="setting-toggle"></ion-toggle>
            </div>

            <div class="setting-row">
              <div class="setting-icon">
                <ion-icon name="moon-outline"></ion-icon>
              </div>
              <div class="setting-content">
                <span class="setting-label">Dark Mode</span>
              </div>
              <ion-toggle [(ngModel)]="darkModeEnabled" mode="md" class="setting-toggle"></ion-toggle>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-section">
          @if (isEditMode) {
            <ion-button class="btn-secondary" expand="block" (click)="cancelEdit()">
              Cancel
            </ion-button>
            <ion-button class="btn-primary" expand="block" (click)="saveProfile()">
              Save Changes
            </ion-button>
          } @else {
            <ion-button class="logout-btn" expand="block" (click)="logout()">
              <ion-icon name="log-out-outline" slot="start"></ion-icon>
              Logout
            </ion-button>
          }
        </div>
      </div>
    </div>
  </div>
</ion-content>
